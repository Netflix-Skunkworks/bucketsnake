<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>S3 Background Information · Bucket Snake</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="S3 Background Information · Bucket Snake"/><meta property="og:type" content="website"/><meta property="og:url" content="https://github.com/Netflix-Skunkworks/bucketsnake/bucketsnake/index.html"/><meta property="og:description" content="AWS S3 has a complex permissions model. Before continuing, please review the following documents:"/><link rel="shortcut icon" href="/bucketsnake/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/bucketsnake/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/bucketsnake/"><img class="logo" src="/bucketsnake/img/logo.png"/><h2 class="headerTitle">Bucket Snake</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/bucketsnake/docs/intro.html" target="_self">Docs</a></li><li><a href="https://github.com/Netflix-Skunkworks/bucketsnake" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Introduction &amp; Background</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction &amp; Background</h3><ul><li class="navListItem"><a class="navItem" href="/bucketsnake/docs/intro.html">Introduction</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/bucketsnake/docs/s3background.html">S3 Background</a></li><li class="navListItem"><a class="navItem" href="/bucketsnake/docs/howitworks.html">How it works</a></li><li class="navListItem"><a class="navItem" href="/bucketsnake/docs/permissions.html">Permission Reference</a></li></ul></div><div class="navGroup navGroupActive"><h3>Installation &amp; Configuration</h3><ul><li class="navListItem"><a class="navItem" href="/bucketsnake/docs/installation.html">Deployment</a></li><li class="navListItem"><a class="navItem" href="/bucketsnake/docs/configuration.html">Configuration</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>S3 Background Information</h1></header><article><div><span><p>AWS S3 has a complex permissions model. Before continuing, please review the following documents:</p>
<ul>
<li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-overview.html">S3 Access Control Overview</a></li>
<li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/how-s3-evaluates-access-control.html">How Amazon S3 Authorizes a Request</a></li>
<li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-auth-workflow-bucket-operation.html">How Amazon S3 Authorizes a Request for a Bucket Operation</a></li>
<li><strong>And Perhaps Most Importantly: <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-auth-workflow-object-operation.html">How Amazon S3 Authorizes a Request for an Object Operation</a></strong></li>
</ul>
<h2><a class="anchor" aria-hidden="true" name="bucket-owner-and-object-owner"></a><a href="#bucket-owner-and-object-owner" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bucket Owner and Object Owner?</h2>
<p>S3 has a complex permissions model that examines the &quot;owner&quot; of a resource when making an access decision.</p>
<p>An &quot;Owner&quot; refers to an AWS account which the resource belongs to. With regards to a bucket, this is the account that a bucket &quot;resides&quot; in.</p>
<p>So, if account <code>Foo</code> had a bucket named <code>thebucket</code>, <code>Foo</code> would be the owner of <code>thebucket</code>.</p>
<p>Objects also have ownership. Object ownership refers to the AWS account that <em>put</em> the object into the bucket.</p>
<p>So, if an IAM role in account <code>Foo</code> put an object into the <code>thebucket</code> bucket, then the object would be owned by <code>Foo</code>.</p>
<h3><a class="anchor" aria-hidden="true" name="cross-account-ownership"></a><a href="#cross-account-ownership" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cross-account ownership</h3>
<p>When bucket and object ownership is the same (that is the account that owns the bucket and the object are the same), then access is straightforward. In this case, IAM in the account, as well as the bucket policy determines whether or not access is granted to the object.</p>
<p>Trouble begins when the ownership is different. Buckets can hold objects that belong to different AWS accounts. For example: Take two AWS accounts: <code>Foo</code> and <code>Bar</code>. Bucket <code>thebucket</code> resides in account <code>Foo</code>. <code>Bar</code> has an IAM role named <code>theRole</code> that can place an object named <code>theobj</code> in <code>thebucket</code>. If an application with <code>theRole</code> (<code>Bar</code> account) places the object, the object will reside in <code>thebucket</code> (owned by <code>Foo</code>), but the object will be owned by <code>Bar</code>.</p>
<p>This may not seem like an issue at first, however, reviewing <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-auth-workflow-object-operation.html">AWS's documentation regarding object access</a>, access to this object will ultimately be determined by the <code>Bar</code> account. That is achieved when <code>Bar</code> places an ACL on <code>theobj</code> to explicitly grant another AWS account access.</p>
<p>In this example, without any ACLs applied to <code>theobj</code>, despite <code>Foo</code> being the owner of the <code>thebucket</code> bucket, IAM roles in <code>Foo</code> won't be able to read the object or otherwise manipulate it. <code>Foo</code> will be able to see that the object is there, and can delete the object, but can't otherwise make any modifications to it.</p>
<p>To resolve this issue, <code>Bar</code> would need to add an ACL to <code>theobj</code> so that <code>Foo</code> has access to it. One common way to resolve this is to put the <code>bucket-owner-full-control</code> canned ACL on the object. While that may alleviate access issues in this example, it does not fully resolve the issue.</p>
<h3><a class="anchor" aria-hidden="true" name="acls-are-a-bad-solution"></a><a href="#acls-are-a-bad-solution" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ACLs are a bad solution</h3>
<p>The <code>bucket-owner-full-control</code> canned ACL may seem like a solution to this problem, but it's not. The owner of the object in this example is still not the same as the owner of the bucket. Thus, the decision to read/write/modify the object is still determined by <code>Bar</code> (the object owning account).</p>
<p>If a new account, <code>Baz</code> requires access to the bucket and objects within it, the ACL of the objects would need to be altered again to permit <code>Baz</code> access. This is where scalability becomes very difficult over time. This complexity gets significantly worse as objects and accounts increase.</p>
<h3><a class="anchor" aria-hidden="true" name="iam-roles-can-permanently-solve-this-problem"></a><a href="#iam-roles-can-permanently-solve-this-problem" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IAM Roles can permanently solve this problem</h3>
<p>Avoiding cross-account object and bucket ownership is <em>strongly</em> advised. This is resolved by always performing S3 operations with an IAM role within the bucket owning account. Doing this ensures that the bucket owner and object owner are the same.</p>
<p>This also helps simplify access by reducing the number of places where S3 permissions can live, which ultimately improves the security of your infrastructure.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="intro.html">← Introduction</a><a class="docs-next button" href="howitworks.html">How Bucket Snake Works →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/bucketsnake/" class="nav-home"><img src="/bucketsnake/img/logo.png" alt="Bucket Snake" width="66" height="58"/></a><div><h5>Background</h5><a href="/bucketsnake/docs/intro.html">Introduction</a><a href="/bucketsnake/docs/s3background.html">General S3 Background</a><a href="/bucketsnake/docs/howitworks.html">How Bucket Snake Works</a></div><div><h5>Getting Started</h5><a href="/bucketsnake/docs/installation.html">Installation</a><a href="/bucketsnake/docs/configuration.html">Configuration</a></div><div><h5>Community</h5><a href="https://github.com/Netflix-Skunkworks/bucketsnake">GitHub</a></div></section><section class="copyright">These docs were created with <a href="https://docusaurus.io/">Docusaurus</a>.</section><section class="copyright" style="padding-top:10px;">Copyright © 2017 Netflix, Inc.</section></footer></div></body></html>